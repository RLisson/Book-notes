<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Notes - Suas AvaliaÃ§Ãµes de Livros</title>
    <link rel="stylesheet" href="styles/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>
<body>
    <%- include('header.ejs') %>
    <main>
        <section class="books-grid">
            <% if (avaliations && avaliations.length > 0) { %>
                <ul>
                    <% avaliations.forEach(avaliation => { %>
                        <li class="book-card">
                            <a href="/avaliations/<%= avaliation.id %>" class="card-link">
                                <img src="<%= avaliation.book_cover %>" 
                                     alt="Capa do livro <%= avaliation.title %>" 
                                     loading="lazy">
                                <div class="book-info">
                                    <h2><%= avaliation.title %></h2>
                                    <% if (avaliation.author) { %>
                                        <p class="book-author">por <%= avaliation.author %></p>
                                    <% } %>
                                    <% if (avaliation.note !== null && avaliation.note !== undefined) { %>
                                        <div class="rating">
                                            <% 
                                            // Converter avaliaÃ§Ã£o de 0-10 para 0-5 estrelas
                                            const rating = parseFloat(avaliation.note);
                                            const starRating = (rating / 10) * 5; // Converte para escala de 5 estrelas
                                            %>
                                            
                                            <% for(let i = 1; i <= 5; i++) { %>
                                                <% if (starRating >= i) { %>
                                                    <span class="star filled">â˜…</span>
                                                <% } else if (starRating >= i - 0.5) { %>
                                                    <span class="star half-filled">â˜…</span>
                                                <% } else { %>
                                                    <span class="star">â˜…</span>
                                                <% } %>
                                            <% } %>
                                            
                                            <span class="rating-text">(<%= rating %>/10)</span>
                                        </div>
                                    <% } %>
                                </div>
                            </a>
                        </li>
                    <% }); %>
                </ul>
            <% } else { %>
                <div class="empty-state">
                    <h2>ðŸ“– Nenhum livro encontrado</h2>
                    <p>Comece adicionando suas primeiras avaliaÃ§Ãµes de livros!</p>
                    <a href="/add" class="add-button">Adicionar Livro</a>
                </div>
            <% } %>
        </section>
    </main>
</body>
</html>